<!doctype html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
  </head>

  <body>
    <p>
      Please input the number of people attending and the desired drinks per person. Then, click the button to calculate.
    </p>
    
    <input type="number" id="people" placeholder="Number of people" />
    <input type="number" id="drinks_per" placeholder="Drinks per person" />
    
    <button onclick="evaluatePython(people,drinks_per)">Run</button>
    <br />
    <br />
    <div>Output:</div>
    <textarea id="output" style="width: 100%;" rows="6" disabled></textarea>

    <script>
      const output = document.getElementById("output");
      const code = document.getElementById("code");


      output.value = "Initializing...\n";
      // init Pyodide
      async function main() {
        let pyodide = await loadPyodide();
        output.value += "Ready!\n";
        return pyodide;
      }
      let pyodideReadyPromise = main();

      await pyodide.runPythonAsync(`
        from pyodide.http import pyfetch
        response = await pyfetch("https://github.com/zachjaffery/calculator/blob/06e157c7cb64151598ac12f764d25784c6f06991/calc_script.py")
        with open("script.py", "wb") as f:
          f.write(await response.bytes())
      `)
      pkg = pyodide.pyimport("script");
      pkg.calc_script(people,drinks_per);

      async function evaluatePython() {
        let pyodide = await pyodideReadyPromise;
        try {
          let output = pyodide.runPython(code.value);
        } catch (err) {
        }
      }
    </script>
  </body>
</html>
